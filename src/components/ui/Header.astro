<header
    id="main-header"
    class="fixed top-0 left-0 right-0 z-50 flex justify-center py-3 transition-all duration-300 ease-in-out"
    style="will-change: transform, opacity;"
>
    <div class="flex justify-between items-center w-full max-w-[1120px] px-4">
        <a href="/" aria-label="Go to homepage">
            <img
                class="rounded-full w-10 h-10 border-2 border-transparent hover:border-slate-400 transition"
                src="https://avatars.githubusercontent.com/u/75331658?v=4"
                alt="Edgar profile picture"
            />
        </a>
        <nav
            id="main-nav"
            class="flex flex-row gap-x-6 sm:gap-x-10 text-sm sm:text-base items-center"
        >
            <a href="#home" class="hover:text-purple-400 transition">Home</a>
            <a href="#about" class="hover:text-purple-400 transition">About</a>
            <a href="#projects" class="hover:text-purple-400 transition"
                >Projects</a
            >
            <a href="#contact" class="hover:text-purple-400 transition"
                >Contact</a
            >
            <div class="animated-border ml-2">
                <a
                    href="/resume.pdf"
                    download
                    class="premium-glass-panel flex items-center gap-2 font-semibold text-white px-5 py-2 rounded-2xl shadow-glow transform-on-hover focus:outline-none focus:ring-2 focus:ring-purple-400 transition-all duration-300"
                    aria-label="Download resume in PDF"
                    style="border-radius: 1.25rem; min-width: 150px; justify-content: center;"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5m0 0l5-5m-5 5V4"
                        ></path>
                    </svg>
                    Download resume
                </a>
            </div>
        </nav>
    </div>
</header>

<script>
    // Throttle para optimizar el scroll
    function throttle(fn: (...args: any[]) => void, wait: number) {
        let lastTime = 0;
        return function (...args: any[]) {
            const now = Date.now();
            if (now - lastTime >= wait) {
                lastTime = now;
                fn.apply(this, args);
            }
        };
    }

    const header = document.getElementById("main-header");
    const handleScroll = () => {
        if (header && window.scrollY > 50) {
            header.classList.add("header-scrolled");
        } else if (header) {
            header.classList.remove("header-scrolled");
        }
    };
    const throttledScroll = throttle(handleScroll, 100);

    let listenersAdded = false;
    function addListeners() {
        if (!listenersAdded) {
            document.addEventListener("scroll", throttledScroll, {
                passive: true,
            });
            document.addEventListener("astro:page-load", handleScroll);
            listenersAdded = true;
        }
    }
    function removeListeners() {
        if (listenersAdded) {
            document.removeEventListener("scroll", throttledScroll);
            document.removeEventListener("astro:page-load", handleScroll);
            listenersAdded = false;
        }
    }

    if (header) {
        addListeners();
        handleScroll();
        // Limpieza robusta para evitar fugas de memoria
        window.addEventListener("beforeunload", removeListeners);
        window.addEventListener("astro:page-unload", removeListeners);
    } else {
        console.warn("Element with ID 'main-header' not found.");
    }
</script>
